paths:
  /backends/google/sources/{source_uuid}/contacts:
    get:
      description: '**Required ACL:** `dird.backends.google.sources.{source_uuid}.contacts.read`'
      operationId: list_contacts from source
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - in: path
          name: source_uuid
          required: true
          description: Source uuid
          type: string
      summary: Retrieve all contacts from `google`
      tags:
        - google
      responses:
        '200':
          description: |
            Contacts as fetched from google api.

            To know more about google contacts properties, see
            https://docs.google.com/en-us/graph/api/resources/contact?view=graph-rest-1.0#properties
          schema:
            $ref: '#/definitions/GoogleContactList'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: No such source
          schema:
            $ref: '#/definitions/Error'
        '503':
          description: Another service is unavailable (e.g. wazo-auth, google, ...)
          schema:
            $ref: '#/definitions/Error'

  /backends/google/sources:
    get:
      operationId: list_google_source
      summary: Get google configuration
      description: '**Required ACL:** `dird.backends.google.sources.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/recurse'
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/Limit'
        - $ref: '#/parameters/Offset'
      responses:
        '200':
          description: Configured google source
          schema:
            $ref: '#/definitions/GoogleSourceItems'
    post:
      operationId: create_google_source
      summary: Configure a source for the google backend
      description: '**Required ACL:** `dird.backends.google.sources.create`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - in: body
          name: body
          description: The display configuration body
          required: true
          schema:
            $ref: '#/definitions/GoogleSource'
      responses:
        '201':
          description: The created display
          schema:
            $ref: '#/definitions/GoogleSource'
          examples:
            application/json:
              auth:
                host: localhost
                port: 9497
                verify_certificate: /usr/share/xivo-certs/server.crt
                version: 0.1
              format_columns:
                phone: "{numbers[home]}"
                phone_mobile: "{numbers[mobile]}"
                reverse: "{name}"
                email: "{emails[home]}"
              name: google
        '400':
          $ref: '#/responses/CreateError'
        '409':
          description: Source already exists
          schema:
            $ref: '#/definitions/Error'
  /backends/google/sources/{source_uuid}:
    get:
      operationId: get_a_google_source
      summary: Get a `google` source configuration
      description: '**Required ACL:** `dird.backends.google.sources.{source_uuid}.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '200':
          description: The `google` source
          schema:
            $ref: '#/definitions/GoogleSource'
        '404':
          $ref: '#/responses/NotFoundError'
    put:
      operationId: update_google_source
      summary: Update a `google` source configuration
      description: '**Required ACL:** `dird.backends.google.sources.{source_uuid}.update`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
        - name: body
          in: body
          description: The source configuration body
          required: true
          schema:
            $ref: '#/definitions/GoogleSource'
      responses:
        '204':
          $ref: '#/responses/ResourceUpdated'
        '400':
          $ref: '#/responses/UpdateError'
        '404':
          $ref: '#/responses/NotFoundError'
        '409':
          description: Duplicate Source
          schema:
            $ref: '#/definitions/Error'
    delete:
      operationId: delete_google_source
      summary: Delete a `google` source configuration
      description: '**Required ACL:** `dird.backends.google.sources.{source_uuid}.delete`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '204':
          $ref: '#/responses/ResourceDeleted'
        '404':
          $ref: '#/responses/NotFoundError'
definitions:
  GoogleSource:
    title: GoogleSource
    allOf:
      - $ref: '#/definitions/Source'
      - properties:
          auth:
            $ref: '#/definitions/WazoAuthConfig'
      - required:
        - name
        - auth
        - confd
  GoogleSourcePostFormatColumns:
    title: format_columns
    properties:
      name:
        example: "{firstname} {lastname}"
        type: string
      display_name:
        example: "{firstname} {lastname}"
        type: string
      phone:
        example: "{phone}"
        type: string
      phone_mobile:
        example: "{mobile}"
        type: string
      reverse:
        example: "{firstname} {lastname}"
        type: string
    required:
      - name
      - display_name
      - phone_mobile
      - reverse
  GoogleContactList:
    properties:
      items:
        type: array
        items:
          type: object
        readOnly: true
      total:
        type: integer
        description: The number of contacts
        readOnly: true
      filtered:
        type: integer
        description: The number of contacts matching the searched terms
        readOnly: true
  GoogleSourceItems:
    title: GoogleSourceItems
    allOf:
      - $ref: '#/definitions/SourceItems'
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/GoogleSource'
            readOnly: true
      - required:
        - items
        - total
        - filtered
  WazoAuthConfig:
    title: Auth
    allOf:
      - $ref: '#/definitions/ExternalServiceConfig'
      - properties:
          port:
            type: integer
            default: 9497
          key_file:
            type: string
            description: The path the the file containing the credentials
          username:
            type: string
            description: The username to use when not using a key_file
          password:
            type: string
            description: The password to use when not using a key_file
          version:
            type: string
            default: "0.1"
  ExternalServiceConfig:
    properties:
      host:
        type: string
        default: localhost
      verify_certificate:
        type: string
        description: If the HTTPs certificates should be verified and the path of the certificate if a custom certificate is used.
        default: true
      timeout:
        type: number
